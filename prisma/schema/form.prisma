enum FieldType {
  text
  number
  boolean
  select
  multi_select
  date
  file
}

model Form {
  id          Int              @id @default(autoincrement())
  name        String           @unique
  description String?          @db.Text
  isActive    Boolean          @default(true)
  fields      FieldOnForm[]
  submissions FormSubmission[]
  createdAt   DateTime         @default(now())
  updatedAt   DateTime         @updatedAt
}

model Field {
  id           Int           @id @default(autoincrement())
  name         String        @unique @default(uuid())
  label        String        @default("برچسپ")
  type         FieldType     @default(text)
  placeholder  String?
  required     Boolean       @default(false)
  options      FieldOption[]
  validation   String? // JSON string of validation rules
  defaultValue String?
  order        Int           @default(0)
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
  forms        FieldOnForm[]
}

model FieldOnForm {
  formId  Int
  fieldId Int
  form    Form  @relation(fields: [formId], references: [id], onDelete: Cascade)
  field   Field @relation(fields: [fieldId], references: [id], onDelete: Cascade)

  @@id([formId, fieldId]) // تعریف کلید مرکب برای ارتباط Many-to-Many
}

model FieldOption {
  id        Int      @id @default(autoincrement())
  fieldId   Int
  field     Field    @relation(fields: [fieldId], references: [id], onDelete: Cascade)
  label     String
  value     String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model FormSubmission {
  id     Int                   @id @default(autoincrement())
  formId Int
  form   Form                  @relation(fields: [formId], references: [id], onDelete: Cascade)
  values FormSubmissionValue[]
  data   Json // Stores form submission data

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  requests Request[]
}

model FormSubmissionValue {
  id           Int            @id @default(autoincrement())
  submissionId Int
  submission   FormSubmission @relation(fields: [submissionId], references: [id], onDelete: Cascade)
  value        String // مقدار ورودی کاربر
}
