model Product {
  id            Int                @id @default(autoincrement())
  name          String
  description   String?
  blog          Json? // ذخیره توضیحات با فرمت HTML یا Markdown
  price         Float
  stock         Int                @default(0)
  warrantyId    Int?
  isActive      Boolean            @default(false)
  warranty      Warranty?          @relation(fields: [warrantyId], references: [id], onDelete: SetNull)
  categoryId    Int?
  category      Category?          @relation(fields: [categoryId], references: [id], onDelete: SetNull)
  brandId       Int?
  brand         Brand?             @relation(fields: [brandId], references: [id], onDelete: SetNull)
  attributes    ProductAttribute[]
  variants      ProductVariant[]
  reviews       Review[]
  expertReviews ExpertReview[]
  images        ProductImage[]
  createdAt     DateTime           @default(now())
  updatedAt     DateTime           @updatedAt

  InvoiceItem InvoiceItem[]
}

model ProductImage {
  id        Int      @id @default(autoincrement())
  productId Int?
  product   Product? @relation(fields: [productId], references: [id], onDelete: Cascade)
  url       String
  alt       String?
  isPrimary Boolean  @default(false)
  sortOrder Int      @default(0)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Category {
  id          Int     @id @default(autoincrement())
  name        String  @unique
  slug        String  @unique
  description String?
  parentId    Int?

  lft   Int @default(0)
  rgt   Int @default(0)
  depth Int @default(0)

  parent    Category?  @relation("CategoryToCategory", fields: [parentId], references: [id], onDelete: Cascade)
  children  Category[] @relation("CategoryToCategory")
  products  Product[]
  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt
}

model Brand {
  id          Int       @id @default(autoincrement())
  name        String    @unique
  logoUrl     String?
  website     String?
  description String?
  products    Product[]
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
}

model Attribute {
  id           Int                @id @default(autoincrement())
  name         String             @unique
  type         String // 'text', 'number', 'boolean', 'select', 'multi_select', 'color', etc.
  options      String? // JSON format for select options
  isComparable Boolean            @default(true)
  products     ProductAttribute[]
  createdAt    DateTime           @default(now())
  updatedAt    DateTime           @updatedAt
}

model ProductAttribute {
  id          Int       @id @default(autoincrement())
  productId   Int
  attributeId Int
  value       String // Attribute value
  product     Product   @relation(fields: [productId], references: [id], onDelete: Cascade)
  attribute   Attribute @relation(fields: [attributeId], references: [id], onDelete: Cascade)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
}

model ProductVariant {
  id         Int      @id @default(autoincrement())
  productId  Int
  product    Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
  sku        String?  @unique
  price      Float
  stock      Int      @default(0)
  attributes Json // JSON for variant-specific attributes (e.g., color, size)
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
}

model Warranty {
  id          Int       @id @default(autoincrement())
  name        String
  duration    Int // Warranty duration in months
  description String?
  products    Product[]
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
}

model Review {
  id        Int      @id @default(autoincrement())
  productId Int
  product   Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
  userId    Int
  rating    Float // 1-5 star rating
  comment   String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  User      User     @relation(fields: [userId], references: [id])
}

model ExpertReview {
  id        Int      @id @default(autoincrement())
  productId Int
  product   Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
  author    String // Name of the expert reviewer
  rating    Float // Overall rating
  pros      Json // Strengths (e.g., ["Long battery life", "Great display"])
  cons      Json // Weaknesses (e.g., ["Expensive", "Limited ports"])
  content   String // Full review content
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}
